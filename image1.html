<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Image1</title>
    <meta name="description" content="360&deg; Image Gallery - A-Frame">
    <script src="build.js"></script>

    <script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>
    <script src="https://npmcdn.com/aframe-animation-component@3.0.1"></script>
    <script src="https://npmcdn.com/aframe-event-set-component@3.0.1"></script>
    <script src="https://npmcdn.com/aframe-layout-component@3.0.1"></script>
    <script src="https://npmcdn.com/aframe-template-component@3.1.1"></script>

    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v3.8.1/dist/aframe-extras.min.js"></script>
    <script src="set-image.js"></script>
  </head>
  <body>
    <a-scene>
      <a-assets>
        <img id="pic1" crossorigin="anonymous" src="img/pic1.jpg">
        <img id="sound_icon" crossorigin="anonymous" src="img/sound_icon.png">
        <img id="home_icon" crossorigin="anonymous" src="img/home_icon.png">
        <img id="back_icon" crossorigin="anonymous" src="img/back_icon.png">
        <audio crossorigin="anonymous" src="assets/voice_message.mp3"></audio>
      </a-assets>

      <a-entity position="0 0 0">
        <a-camera></a-camera>
        
        <a-entity id="remote" daydream-controller raycaster="objects: .selectable">
          <a-cone id="ray" color="cyan" position="0 0 -2" rotation="-90 0 0" radius-bottom="0.005" radius-top="0.001" height="4"></a-cone>
          <a-box id="position-guide" visible="false" position="0 0 -2"></a-box>
        </a-entity>
      </a-entity>
      <!-- 360-degree image. -->
      <a-sky id="image-360" radius="10" src="#pic1"></a-sky>
     
      <!-- Sound -->
      <a-entity id="voice_message" position="0 0 0" sound="src: url(assets/voice_message.mp3); autoplay: false"></a-entity>

      <!-- Icons -->
      <a-image class="selectable" id="back_icon" src="#back_icon" position="0 -1 -4" width="1" height="1" onclick="location.href='../index.html'"></a-image>
      <a-image class="selectable" id="sound" src="#sound_icon" position="1 -1 -4" width="1" height="1"></a-image>
      <a-image class="selectable" src="#home_icon" position="2 -1 -4" width="1" height="1"></a-image>
  
      <script>
      var remote = document.querySelector('#remote');
      var sound = document.querySelector('.selectable');
      var ray = document.querySelector('#ray');
      var voice_message = document.querySelector('#voice_message');
      var touchStartAxes;
      var minScale = 0.1;
      var scaleMultiplier = 1;
      var newScale = currentScale = 1;
      var focused = false;
      
      // icons selected
      sound.addEventListener('raycaster-intersected', function () {
        if (focused) return;
        focused = true;
        sound.setAttribute('width','1.5');
        sound.setAttribute('height','1.5');
      });
      sound.addEventListener('raycaster-intersected-cleared', function () {
        focused = false;
        sound.setAttribute('width','1.0');
        sound.setAttribute('height','1.0');
      })
      // trackpad to scale
      remote.addEventListener('axismove', function (e) {
        if (!touchStartAxes) return;
        var deltaX = e.detail.axis[0] - touchStartAxes[0];
        newScale = currentScale + deltaX*scaleMultiplier;
        if (newScale < minScale) newScale = minScale;
        sound.setAttribute('scale',newScale+' '+newScale+' '+newScale);
      });
      remote.addEventListener('touchstart', function (e) {
        touchStartAxes = e.detail.axis;
      });
      remote.addEventListener('touchend', function (e) {
        touchStartAxes = null;
        currentScale = newScale;
      });
      remote.addEventListener('buttondown', function (e) {
        sound.setAttribute('color','black');
        voice_message.setAttribute('sound','src: url(assets/voice_message.mp3); autoplay: true');
        // location.href='image1.html'
      });
      remote.addEventListener('buttonup', function (e) {
        if (focused) {
          sound.setAttribute('color','purple');
        } else {
          sound.setAttribute('color','orange');
        }
      });
    </script>
    </a-scene>
  </body>
</html>