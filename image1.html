<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Image1</title>
    <script src="scripts/build.js"></script>
    <!-- <script src="scripts/autoEnterVR.js"></script> -->
    <script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>
    <script src="https://npmcdn.com/aframe-animation-component@3.0.1"></script>
    <script src="https://npmcdn.com/aframe-event-set-component@3.0.1"></script>
    <script src="https://npmcdn.com/aframe-layout-component@3.0.1"></script>
    <script src="https://npmcdn.com/aframe-template-component@3.1.1"></script>

    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v3.8.1/dist/aframe-extras.min.js"></script>
    <!-- <script src="set-image.js"></script> -->
  </head>
  <body>
    <a-scene>
      <a-assets>
        <img id="pic1" crossorigin="anonymous" src="img/pic1.jpg">
        <img id="sound_icon" crossorigin="anonymous" src="img/sound_icon.png">
        <img id="home_icon" crossorigin="anonymous" src="img/home_icon.png">
        <img id="back_icon" crossorigin="anonymous" src="img/back_icon.png">
        <audio crossorigin="anonymous" src="assets/voice_message.mp3"></audio>
      </a-assets>

      <a-entity position="0 0 1">
        <a-camera></a-camera>
        
        <a-entity id="remote" daydream-controller raycaster="objects: .selectable">
          <a-cone id="ray" color="cyan" position="0 0 -2" rotation="-90 0 0" radius-bottom="0.005" radius-top="0.001" height="4"></a-cone>
          <a-box id="position-guide" visible="false" position="0 0 -2"></a-box>
        </a-entity>
      </a-entity>
      
      <!-- 360-degree image. -->
      <a-sky id="image-360" radius="10" src="#pic1"></a-sky>
     
      <!-- Sound -->
      <a-entity id="voice_message" position="0 0 0" sound="src: url(assets/voice_message.mp3); autoplay: false"></a-entity>

      <!-- Icons -->
      <a-image class="selectable" id="back" src="#back_icon" position="0.5 -1 -4" width="1" height="1"></a-image>
      <a-image class="selectable" id="speaker" src="#sound_icon" position="1.5 -1 -4" width="1" height="1"></a-image>
      <a-image class="selectable" id="home" src="#home_icon" position="2.5 -1 -4" width="1" height="1"></a-image>
  
      <script>
      var sound = document.querySelector('[sound]');

      var remote = document.querySelector('#remote');
      var back = document.querySelector('#back');
      var speaker = document.querySelector('#speaker');
      var home = document.querySelector('#home');

      var shouldPlaySound = false;
      var goBack = false;
      var backToHome = true;

      var ray = document.querySelector('#ray');
      var voice_message = document.querySelector('#voice_message');
      var touchStartAxes;
      var minScale = 0.1;
      var scaleMultiplier = 1;
      var newScale = currentScale = 1;
      var focused = false;
      
      // back selected
      back.addEventListener('raycaster-intersected', function () {
        if (focused) return;
        focused = true;
        back.setAttribute('width','1.3');
        back.setAttribute('height','1.3');
        goBack = true;
      });
      back.addEventListener('raycaster-intersected-cleared', function () {
        focused = false;
        back.setAttribute('width','1.0');
        back.setAttribute('height','1.0');
        goBack = false;
      })
      // go back to original water scene
      remote.addEventListener('buttondown', function (e) {
        var target1 = e.target 
        // console.log(e.target);
        if (goBack == true){
          location.href='home.html'
        };
      });

      // sound selected
      speaker.addEventListener('raycaster-intersected', function () {
        if (focused) return;
        focused = true;
        speaker.setAttribute('width','1.3');
        speaker.setAttribute('height','1.3');
        shouldPlaySound = true;
      });
      speaker.addEventListener('raycaster-intersected-cleared', function () {
        focused = false;
        speaker.setAttribute('width','1.0');
        speaker.setAttribute('height','1.0');
        shouldPlaySound = false;
      })
      // play sound
      remote.addEventListener('buttondown', function (e) {
        var target1 = e.target 
        // console.log(e.target);
        if (shouldPlaySound == true){
          voice_message.components.sound.playSound();
        } else{
          voice_message.components.sound.pauseSound();
          // voice_message.setAttribute('sound','src: url(assets/voice_message.mp3); autoplay: true');
        }
      });

      // home selected
      home.addEventListener('raycaster-intersected', function () {
        if (focused) return;
        focused = true;
        backToHome = true;
        home.setAttribute('width','1.3');
        home.setAttribute('height','1.3');
      });
      home.addEventListener('raycaster-intersected-cleared', function () {
        focused = false;
        home.setAttribute('width','1.0');
        home.setAttribute('height','1.0');
        backToHome = false;
      })

      remote.addEventListener('buttonup', function (e) {
        if (focused) {
          sound.setAttribute('color','purple');
        } else {
          sound.setAttribute('color','orange');
        }
      });
      // go back to index.html 
      remote.addEventListener('buttondown', function (e) {
        var target1 = e.target 
        // console.log(e.target);
        if (backToHome = true){
          location.href='index.html'
        };
      });

      // auto enter VR
        window.addEventListener('load', function () {
          var scene = document.querySelector('a-scene');
          if (scene.hasLoaded) {
            scene.enterVR();
          } else {
            el.addEventListener('loaded', function () {
              scene.enterVR();
            });
          }
        });
    </script>
    </a-scene>
  </body>
</html>